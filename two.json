{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/ChingLingChen/FIT3179-Visualization-2/refs/heads/main/Malaysia%20yeartodate.csv"
  },
  "params": [
    {
      "name": "monthFilter",
      "select": {
        "type": "point",
        "fields": ["Month"],
        "toggle": false,
        "clear": "dblclick",
        "empty": "all"
      }
    }
  ],
  "vconcat": [
    {
      "title": "Precipitation vs Humidity",
      "width": 500,
      "height": 500,
      "transform": [
        { "calculate": "toDate(datum.datetime)", "as": "date_obj" },
        { "calculate": "timeFormat(datum.date_obj, '%b')", "as": "Month" },
        { "filter": "datum.precip > 0 && datum.humidity > 0" }
      ],
      "mark": { "type": "circle", "tooltip": true },
      "encoding": {
        "x": { "field": "precip", "type": "quantitative", "title": "Precipitation (in)" },
        "y": { "field": "humidity", "type": "quantitative", "title": "Humidity (%)" },
        "color": {
          "field": "Month",
          "type": "ordinal",
          "scale": {
            "domain": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"],
            "range": ["#aec7e8", "#ffbb78", "#a3bffa", "#ff9896", "#c5b0d5", "#f7b6d2", "#c49c94", "#b0b7f2", "#9edae5", "#fdd0a2"]
          }
        },
        "size": {
          "field": "windspeed",
          "type": "quantitative",
          "title": "Wind Speed (mph)",
          "scale": { "range": [10, 100] }
        },
        "opacity": {
          "condition": { "param": "monthFilter", "value": 0.95 },
          "value": 0.25
        },
        "tooltip": [
          { "field": "Month", "type": "ordinal", "title": "Month" },
          { "field": "precip", "type": "quantitative", "title": "Precipitation" },
          { "field": "humidity", "type": "quantitative", "title": "Humidity" }
        ]
      }
    },
    {
      "vconcat": [
        {
          "hconcat": [
            {
              "title": "Average Cloudcover",
              "width": 250,
              "height": 200,
              "transform": [
                { "calculate": "timeFormat(toDate(datum.datetime), '%b')", "as": "Month" },
                { "filter": "isValid(datum.cloudcover) && datum.cloudcover !== null" },
                {
                  "aggregate": [
                    { "op": "mean", "field": "cloudcover", "as": "avg_cloudcover" }
                  ],
                  "groupby": ["Month"]
                }
              ],
              "mark": { "type": "bar", "binSpacing": 0.5, "width": 15 },
              "encoding": {
                "x": {
                  "field": "Month",
                  "type": "ordinal",
                  "title": "Month",
                  "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]
                },
                "y": { "field": "avg_cloudcover", "type": "quantitative", "title": null },
                "color": {
                  "field": "Month",
                  "type": "ordinal",
                  "scale": {
                    "domain": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"],
                    "range": ["#aec7e8", "#ffbb78", "#a3bffa", "#ff9896", "#c5b0d5", "#f7b6d2", "#c49c94", "#b0b7f2", "#9edae5", "#fdd0a2"]
                  }
                },
                "opacity": {
                  "condition": { "param": "monthFilter", "value": 0.95 },
                  "value": 0.25
                },
                "tooltip": [
                  { "field": "Month", "type": "ordinal", "title": "Month" },
                  { "field": "avg_cloudcover", "type": "quantitative", "title": "Average cloudcover", "format": ".2f" }
                ]
              }
            },
            {
              "title": "Average Visibility",
              "width": 250,
              "height": 200,
              "transform": [
                { "calculate": "timeFormat(toDate(datum.datetime), '%b')", "as": "Month" },
                { "filter": "isValid(datum.visibility) && datum.visibility !== null" },
                {
                  "aggregate": [
                    { "op": "mean", "field": "visibility", "as": "avg_visibility" }
                  ],
                  "groupby": ["Month"]
                }
              ],
              "mark": { "type": "bar", "binSpacing": 0.5, "width": 15 },
              "encoding": {
                "x": {
                  "field": "Month",
                  "type": "ordinal",
                  "title": "Month",
                  "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]
                },
                "y": { "field": "avg_visibility", "type": "quantitative", "title": null },
                "color": {
                  "field": "Month",
                  "type": "ordinal"
                },
                "opacity": {
                  "condition": { "param": "monthFilter", "value": 0.95 },
                  "value": 0.25
                },
                "tooltip": [
                  { "field": "Month", "type": "ordinal", "title": "Month" },
                  { "field": "avg_visibility", "type": "quantitative", "title": "Average visibility", "format": ".2f" }
                ]
              }
            }
          ]
        },
        {
          "hconcat": [
            {
              "title": "Average Solarradiation",
              "width": 250,
              "height": 200,
              "transform": [
                { "calculate": "timeFormat(toDate(datum.datetime), '%b')", "as": "Month" },
                { "filter": "isValid(datum.solarradiation) && datum.solarradiation !== null" },
                {
                  "aggregate": [
                    { "op": "mean", "field": "solarradiation", "as": "avg_solarradiation" }
                  ],
                  "groupby": ["Month"]
                }
              ],
              "mark": { "type": "bar", "binSpacing": 0.5, "width": 15 },
              "encoding": {
                "x": {
                  "field": "Month",
                  "type": "ordinal",
                  "title": "Month",
                  "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]
                },
                "y": { "field": "avg_solarradiation", "type": "quantitative", "title": null },
                "color": { "field": "Month", "type": "ordinal" },
                "opacity": {
                  "condition": { "param": "monthFilter", "value": 0.95 },
                  "value": 0.25
                },
                "tooltip": [
                  { "field": "Month", "type": "ordinal", "title": "Month" },
                  { "field": "avg_solarradiation", "type": "quantitative", "title": "Average solarradiation", "format": ".2f" }
                ]
              }
            },
            {
              "title": "Average Moonphase",
              "width": 250,
              "height": 200,
              "transform": [
                { "calculate": "timeFormat(toDate(datum.datetime), '%b')", "as": "Month" },
                { "filter": "isValid(datum.moonphase) && datum.moonphase !== null" },
                {
                  "aggregate": [
                    { "op": "mean", "field": "moonphase", "as": "avg_moonphase" }
                  ],
                  "groupby": ["Month"]
                }
              ],
              "mark": { "type": "bar", "binSpacing": 0.5, "width": 15 },
              "encoding": {
                "x": {
                  "field": "Month",
                  "type": "ordinal",
                  "title": "Month",
                  "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]
                },
                "y": { "field": "avg_moonphase", "type": "quantitative", "title": null },
                "color": { "field": "Month", "type": "ordinal" },
                "opacity": {
                  "condition": { "param": "monthFilter", "value": 0.95 },
                  "value": 0.25
                },
                "tooltip": [
                  { "field": "Month", "type": "ordinal", "title": "Month" },
                  { "field": "avg_moonphase", "type": "quantitative", "title": "Average moonphase", "format": ".2f" }
                ]
              }
            }
          ]
        }
      ],
      "resolve": { "scale": { "color": "shared" } }
    }
  ],
  "resolve": { "scale": { "color": "shared" } }
}
